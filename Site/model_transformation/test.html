<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Load Local ONNX Model</title>
    <script src="https://cdn.jsdelivr.net/npm/onnxjs@1.5.0/dist/onnx.min.js"></script>
</head>
<body>
    <h1>ONNX.js: Load Local Model</h1>
    <button id="loadModelButton">Load Model</button>
    <button id="predictButton" disabled>Make Prediction</button>
    <p id="output"></p>

    <script>
        // Log the version of onnxjs
        console.log('ONNX.js version:', onnx.version);

        let session;

        async function loadLocalModel() {
            try {
                const MODEL_PATH = '../gleason/public/models/model_example.onnx'; // Replace with your ONNX model path
                console.log('Loading model from:', MODEL_PATH);
                session = new onnx.InferenceSession();
                await session.loadModel(MODEL_PATH);
                console.log('Model loaded successfully');
                document.getElementById('predictButton').disabled = false;
            } catch (e) {
                console.error('Failed to load model:', e);
            }
        }

        async function makePrediction() {
            if (!session) {
                console.log('Model not loaded yet.');
                return;
            }

            try {
                // Example: Create a dummy input tensor (adjust dimensions as needed)
                const inputTensor = new onnx.Tensor(
                    new Float32Array([1.0, 2.0, 3.0, 4.0]),
                    'float32',
                    [1, 4]
                );

                // Run inference
                const outputMap = await session.run([inputTensor]);
                const outputTensor = outputMap.values().next().value;
                const result = outputTensor.data;

                document.getElementById('output').innerText = `Prediction: ${result}`;
                console.log('Prediction:', result);
            } catch (e) {
                console.error('Failed to run inference:', e);
            }
        }

        document.getElementById('loadModelButton').addEventListener('click', loadLocalModel);
        document.getElementById('predictButton').addEventListener('click', makePrediction);
    </script>
</body>
</html>
